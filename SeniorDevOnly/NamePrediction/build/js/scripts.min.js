'use strict';

(function () {
  'use strict';

  // If there isn't names array yet

  if (localStorage.getItem('pokemonsNames') === null) {
    // Take names from public API
    getPokemonsList();
  }

  // Take names from localStorage
  var names = localStorage.pokemonsNames ? JSON.parse(localStorage.pokemonsNames) : [];

  var input = document.getElementById('input');

  //Call selectSuitable function every time when input is changed
  input.oninput = function () {
    selectSuitable(input.value.toLowerCase());
  };

  // Choose name with keyboard
  input.addEventListener('keyup', handleKey);

  var select = document.getElementById('autocomplete');

  // Choose name with mouse
  select.addEventListener('click', showClickedOption);

  var options = document.getElementById('autocomplete').getElementsByTagName('option');

  // Hide predictions when there's onblur event
  input.addEventListener('blur', hideSelect);

  // Show predictions when user 'returns' to input; there's onfocus event
  input.addEventListener('focus', showSelect);

  // **************  
  // All functions are below
  // **************
  function getPokemonsList() {
    // As there are 811 pokemons in www.pokeapi.co, limit=811
    var url = 'http://www.pokeapi.co/api/v2/pokemon/?limit=811';

    // Create new object XMLHttpRequest
    var xhr = new XMLHttpRequest();
    // Confige object XMLHttpRequest
    xhr.open('GET', url, true);
    xhr.onreadystatechange = receiveResponse;
    xhr.send();

    function receiveResponse(e) {
      if (this.readyState == 4) {
        // xhr.readyState == 4, so we've received the complete server response
        if (this.status == 200) {
          // xhr.status == 200, so the response is good
          var result = JSON.parse(xhr.responseText);
          handleNames(result);
        } else {
          noNames();
        }
      }
    }
  }

  function handleNames(result) {

    // Get pokemons array
    var pokemonsArr = result.results;

    // Get pokemons' names
    var pokemonsNames = pokemonsArr.map(function (item) {
      return item.name;
    });

    // Delete not unique names if there are
    pokemonsNames = unique(pokemonsNames);

    // Sort names by alphabet
    pokemonsNames = pokemonsNames.sort();

    // In case if API returns results with capital letters
    pokemonsNames = pokemonsNames.map(function (item) {
      return item.toLocaleLowerCase();
    });

    // Write names array into localStorage
    localStorage.pokemonsNames = JSON.stringify(pokemonsNames);
  }

  // It there's some trouble with the response from API
  function noNames() {
    var sorry = document.createElement('p');
    sorry.innerHTML = 'Sorry, service is unavailable. No pokemons\' names for the prediction is at the moment.';
    sorry.className = 'sorry';

    var section = document.getElementsByClassName('container')[0];
    var form = document.getElementsByClassName('form')[0];
    section.insertBefore(sorry, form);
  }

  function unique(arr) {
    // Create subsidiary object
    var obj = {};

    for (var i = 0; i < arr.length; i++) {
      var str = arr[i]; // Make string from each array element
      obj[str] = true; // Remember each string like object property
    }

    return Object.keys(obj);
  }

  function selectSuitable(text) {
    if (text.length === 0) {
      clearPredictions();
      return;
    }
    var amount = 0;
    var suitNames = [];

    for (var i = 0; i < names.length; i++) {
      // Compare every array element with input text
      var rigthLength = 0;
      for (var j = 0; j < text.length; j++) {
        if (names[i][j] === text[j]) {
          rigthLength++;
        }
      }

      // If length of right symbol is equal text (input.value) length
      if (rigthLength === text.length) {
        suitNames[amount] = names[i];
        amount++;
      }

      // If there's already 5 predictions, stop
      if (amount === 5) {
        break;
      }
    }

    showPredictions(suitNames);
  }

  function clearPredictions() {
    var select = document.getElementById('autocomplete');
    select.innerHTML = '';
  }

  function showPredictions(arr) {
    clearPredictions();

    var select = document.getElementById('autocomplete');

    for (var i = 0; i < arr.length; i++) {
      var option = document.createElement('option');
      option.innerHTML = arr[i];
      option.value = arr[i];
      option.className = 'option';
      select.appendChild(option);
    }
  }

  function handleKey(event) {
    var options = document.getElementById('autocomplete').getElementsByTagName('option');
    var selected = -1;
    switch (event.keyCode) {
      case 40:
        // Key Down arrow is pressed
        selected = -1;
        for (var i = 0; i < options.length; i++) {
          if (i in options && options[i].className === 'selected') {
            options[i].className = 'non-selected';
            selected = i;
          }
        }
        selected++;
        for (var _i = 0; _i < options.length; _i++) {
          if (_i in options && _i === selected) {
            options[_i].className = 'selected';
          }
        }
        break;
      case 38:
        // Key Up arrow is pressed
        selected = options.length;
        for (var _i2 = 0; _i2 < options.length; _i2++) {
          if (_i2 in options && options[_i2].className === 'selected') {
            options[_i2].className = 'non-selected';
            selected = _i2;
          }
        }
        selected--;
        for (var _i3 = 0; _i3 < options.length; _i3++) {
          if (_i3 in options && _i3 === selected) {
            options[_i3].className = 'selected';
          }
        }
        break;
      case 13:
        // Key Enter is pressed
        for (var _i4 = 0; _i4 < options.length; _i4++) {
          if (_i4 in options && options[_i4].className == 'selected') {
            input.value = options[_i4].innerHTML;
            document.getElementById('autocomplete').innerHTML = '';
          }
        }
        break;
    }
  }

  function showClickedOption() {
    var index = document.getElementById('autocomplete').selectedIndex;
    input.value = options[index].innerHTML;
    document.getElementById('autocomplete').innerHTML = '';
  }

  function hideSelect() {
    select.style.display = 'none';
  }

  function showSelect() {
    select.style.display = 'block';
  }
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMubWluLmpzIl0sIm5hbWVzIjpbImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJnZXRQb2tlbW9uc0xpc3QiLCJuYW1lcyIsInBva2Vtb25zTmFtZXMiLCJKU09OIiwicGFyc2UiLCJpbnB1dCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJvbmlucHV0Iiwic2VsZWN0U3VpdGFibGUiLCJ2YWx1ZSIsInRvTG93ZXJDYXNlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUtleSIsInNlbGVjdCIsInNob3dDbGlja2VkT3B0aW9uIiwib3B0aW9ucyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiaGlkZVNlbGVjdCIsInNob3dTZWxlY3QiLCJ1cmwiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWNlaXZlUmVzcG9uc2UiLCJzZW5kIiwiZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXN1bHQiLCJyZXNwb25zZVRleHQiLCJoYW5kbGVOYW1lcyIsIm5vTmFtZXMiLCJwb2tlbW9uc0FyciIsInJlc3VsdHMiLCJtYXAiLCJpdGVtIiwibmFtZSIsInVuaXF1ZSIsInNvcnQiLCJ0b0xvY2FsZUxvd2VyQ2FzZSIsInN0cmluZ2lmeSIsInNvcnJ5IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImNsYXNzTmFtZSIsInNlY3Rpb24iLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiZm9ybSIsImluc2VydEJlZm9yZSIsImFyciIsIm9iaiIsImkiLCJsZW5ndGgiLCJzdHIiLCJPYmplY3QiLCJrZXlzIiwidGV4dCIsImNsZWFyUHJlZGljdGlvbnMiLCJhbW91bnQiLCJzdWl0TmFtZXMiLCJyaWd0aExlbmd0aCIsImoiLCJzaG93UHJlZGljdGlvbnMiLCJvcHRpb24iLCJhcHBlbmRDaGlsZCIsImV2ZW50Iiwic2VsZWN0ZWQiLCJrZXlDb2RlIiwiaW5kZXgiLCJzZWxlY3RlZEluZGV4Iiwic3R5bGUiLCJkaXNwbGF5Il0sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsWUFBWTtBQUNYOztBQUVBOztBQUNBLE1BQUlBLGFBQWFDLE9BQWIsQ0FBcUIsZUFBckIsTUFBMEMsSUFBOUMsRUFBb0Q7QUFDbEQ7QUFDQUM7QUFDRDs7QUFFRDtBQUNBLE1BQUlDLFFBQVFILGFBQWFJLGFBQWIsR0FBNkJDLEtBQUtDLEtBQUwsQ0FBV04sYUFBYUksYUFBeEIsQ0FBN0IsR0FBc0UsRUFBbEY7O0FBRUEsTUFBSUcsUUFBUUMsU0FBU0MsY0FBVCxDQUF3QixPQUF4QixDQUFaOztBQUVBO0FBQ0FGLFFBQU1HLE9BQU4sR0FBZ0IsWUFBWTtBQUMxQkMsbUJBQWVKLE1BQU1LLEtBQU4sQ0FBWUMsV0FBWixFQUFmO0FBQ0QsR0FGRDs7QUFJQTtBQUNBTixRQUFNTyxnQkFBTixDQUF1QixPQUF2QixFQUFnQ0MsU0FBaEM7O0FBRUEsTUFBSUMsU0FBU1IsU0FBU0MsY0FBVCxDQUF3QixjQUF4QixDQUFiOztBQUVBO0FBQ0FPLFNBQU9GLGdCQUFQLENBQXdCLE9BQXhCLEVBQWlDRyxpQkFBakM7O0FBRUEsTUFBSUMsVUFBVVYsU0FBU0MsY0FBVCxDQUF3QixjQUF4QixFQUF3Q1Usb0JBQXhDLENBQTZELFFBQTdELENBQWQ7O0FBRUE7QUFDQVosUUFBTU8sZ0JBQU4sQ0FBdUIsTUFBdkIsRUFBK0JNLFVBQS9COztBQUVBO0FBQ0FiLFFBQU1PLGdCQUFOLENBQXVCLE9BQXZCLEVBQWdDTyxVQUFoQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxXQUFTbkIsZUFBVCxHQUEyQjtBQUN6QjtBQUNBLFFBQUlvQixNQUFNLGlEQUFWOztBQUVBO0FBQ0EsUUFBSUMsTUFBTSxJQUFJQyxjQUFKLEVBQVY7QUFDQTtBQUNBRCxRQUFJRSxJQUFKLENBQVMsS0FBVCxFQUFnQkgsR0FBaEIsRUFBcUIsSUFBckI7QUFDQUMsUUFBSUcsa0JBQUosR0FBeUJDLGVBQXpCO0FBQ0FKLFFBQUlLLElBQUo7O0FBR0EsYUFBU0QsZUFBVCxDQUF5QkUsQ0FBekIsRUFBNEI7QUFDMUIsVUFBSSxLQUFLQyxVQUFMLElBQW1CLENBQXZCLEVBQTBCO0FBQ3hCO0FBQ0EsWUFBSSxLQUFLQyxNQUFMLElBQWUsR0FBbkIsRUFBd0I7QUFBRTtBQUN4QixjQUFJQyxTQUFTM0IsS0FBS0MsS0FBTCxDQUFXaUIsSUFBSVUsWUFBZixDQUFiO0FBQ0FDLHNCQUFZRixNQUFaO0FBQ0QsU0FIRCxNQUdPO0FBQ0xHO0FBQ0Q7QUFDRjtBQUNGO0FBQ0Y7O0FBRUQsV0FBU0QsV0FBVCxDQUFxQkYsTUFBckIsRUFBNkI7O0FBRTNCO0FBQ0EsUUFBSUksY0FBY0osT0FBT0ssT0FBekI7O0FBRUE7QUFDQSxRQUFJakMsZ0JBQWdCZ0MsWUFBWUUsR0FBWixDQUFnQixVQUFVQyxJQUFWLEVBQWdCO0FBQ2xELGFBQU9BLEtBQUtDLElBQVo7QUFDRCxLQUZtQixDQUFwQjs7QUFJQTtBQUNBcEMsb0JBQWdCcUMsT0FBT3JDLGFBQVAsQ0FBaEI7O0FBRUE7QUFDQUEsb0JBQWdCQSxjQUFjc0MsSUFBZCxFQUFoQjs7QUFFQTtBQUNBdEMsb0JBQWdCQSxjQUFja0MsR0FBZCxDQUFrQixVQUFVQyxJQUFWLEVBQWdCO0FBQ2hELGFBQU9BLEtBQUtJLGlCQUFMLEVBQVA7QUFDRCxLQUZlLENBQWhCOztBQUlBO0FBQ0EzQyxpQkFBYUksYUFBYixHQUE2QkMsS0FBS3VDLFNBQUwsQ0FBZXhDLGFBQWYsQ0FBN0I7QUFDRDs7QUFFRDtBQUNBLFdBQVMrQixPQUFULEdBQW1CO0FBQ2pCLFFBQUlVLFFBQVFyQyxTQUFTc0MsYUFBVCxDQUF1QixHQUF2QixDQUFaO0FBQ0FELFVBQU1FLFNBQU4sR0FBa0IseUZBQWxCO0FBQ0FGLFVBQU1HLFNBQU4sR0FBa0IsT0FBbEI7O0FBRUEsUUFBSUMsVUFBVXpDLFNBQVMwQyxzQkFBVCxDQUFnQyxXQUFoQyxFQUE2QyxDQUE3QyxDQUFkO0FBQ0EsUUFBSUMsT0FBTzNDLFNBQVMwQyxzQkFBVCxDQUFnQyxNQUFoQyxFQUF3QyxDQUF4QyxDQUFYO0FBQ0FELFlBQVFHLFlBQVIsQ0FBcUJQLEtBQXJCLEVBQTRCTSxJQUE1QjtBQUNEOztBQUVELFdBQVNWLE1BQVQsQ0FBZ0JZLEdBQWhCLEVBQXFCO0FBQ25CO0FBQ0EsUUFBSUMsTUFBTSxFQUFWOztBQUVBLFNBQUssSUFBSUMsSUFBSSxDQUFiLEVBQWdCQSxJQUFJRixJQUFJRyxNQUF4QixFQUFnQ0QsR0FBaEMsRUFBcUM7QUFDbkMsVUFBSUUsTUFBTUosSUFBSUUsQ0FBSixDQUFWLENBRG1DLENBQ2pCO0FBQ2xCRCxVQUFJRyxHQUFKLElBQVcsSUFBWCxDQUZtQyxDQUVsQjtBQUNsQjs7QUFFRCxXQUFPQyxPQUFPQyxJQUFQLENBQVlMLEdBQVosQ0FBUDtBQUNEOztBQUVELFdBQVMzQyxjQUFULENBQXdCaUQsSUFBeEIsRUFBOEI7QUFDNUIsUUFBSUEsS0FBS0osTUFBTCxLQUFnQixDQUFwQixFQUF1QjtBQUNyQks7QUFDQTtBQUNEO0FBQ0QsUUFBSUMsU0FBUyxDQUFiO0FBQ0EsUUFBSUMsWUFBWSxFQUFoQjs7QUFFQSxTQUFLLElBQUlSLElBQUksQ0FBYixFQUFnQkEsSUFBSXBELE1BQU1xRCxNQUExQixFQUFrQ0QsR0FBbEMsRUFBdUM7QUFDckM7QUFDQSxVQUFJUyxjQUFjLENBQWxCO0FBQ0EsV0FBSyxJQUFJQyxJQUFJLENBQWIsRUFBZ0JBLElBQUlMLEtBQUtKLE1BQXpCLEVBQWlDUyxHQUFqQyxFQUFzQztBQUNwQyxZQUFJOUQsTUFBTW9ELENBQU4sRUFBU1UsQ0FBVCxNQUFnQkwsS0FBS0ssQ0FBTCxDQUFwQixFQUE2QjtBQUMzQkQ7QUFDRDtBQUNGOztBQUVEO0FBQ0EsVUFBSUEsZ0JBQWdCSixLQUFLSixNQUF6QixFQUFpQztBQUMvQk8sa0JBQVVELE1BQVYsSUFBb0IzRCxNQUFNb0QsQ0FBTixDQUFwQjtBQUNBTztBQUNEOztBQUVEO0FBQ0EsVUFBSUEsV0FBVyxDQUFmLEVBQWtCO0FBQ2hCO0FBQ0Q7QUFDRjs7QUFFREksb0JBQWdCSCxTQUFoQjtBQUNEOztBQUVELFdBQVNGLGdCQUFULEdBQTRCO0FBQzFCLFFBQUk3QyxTQUFTUixTQUFTQyxjQUFULENBQXdCLGNBQXhCLENBQWI7QUFDQU8sV0FBTytCLFNBQVAsR0FBbUIsRUFBbkI7QUFDRDs7QUFFRCxXQUFTbUIsZUFBVCxDQUF5QmIsR0FBekIsRUFBOEI7QUFDNUJROztBQUVBLFFBQUk3QyxTQUFTUixTQUFTQyxjQUFULENBQXdCLGNBQXhCLENBQWI7O0FBRUEsU0FBSyxJQUFJOEMsSUFBSSxDQUFiLEVBQWdCQSxJQUFJRixJQUFJRyxNQUF4QixFQUFnQ0QsR0FBaEMsRUFBcUM7QUFDbkMsVUFBSVksU0FBUzNELFNBQVNzQyxhQUFULENBQXVCLFFBQXZCLENBQWI7QUFDQXFCLGFBQU9wQixTQUFQLEdBQW1CTSxJQUFJRSxDQUFKLENBQW5CO0FBQ0FZLGFBQU92RCxLQUFQLEdBQWV5QyxJQUFJRSxDQUFKLENBQWY7QUFDQVksYUFBT25CLFNBQVAsR0FBbUIsUUFBbkI7QUFDQWhDLGFBQU9vRCxXQUFQLENBQW1CRCxNQUFuQjtBQUNEO0FBQ0Y7O0FBR0QsV0FBU3BELFNBQVQsQ0FBbUJzRCxLQUFuQixFQUEwQjtBQUN4QixRQUFJbkQsVUFBVVYsU0FBU0MsY0FBVCxDQUF3QixjQUF4QixFQUF3Q1Usb0JBQXhDLENBQTZELFFBQTdELENBQWQ7QUFDQSxRQUFJbUQsV0FBVyxDQUFDLENBQWhCO0FBQ0EsWUFBUUQsTUFBTUUsT0FBZDtBQUNBLFdBQUssRUFBTDtBQUFTO0FBQ1BELG1CQUFXLENBQUMsQ0FBWjtBQUNBLGFBQUssSUFBSWYsSUFBSSxDQUFiLEVBQWdCQSxJQUFJckMsUUFBUXNDLE1BQTVCLEVBQW9DRCxHQUFwQyxFQUF5QztBQUN2QyxjQUFLQSxLQUFLckMsT0FBTixJQUFtQkEsUUFBUXFDLENBQVIsRUFBV1AsU0FBWCxLQUF5QixVQUFoRCxFQUE2RDtBQUMzRDlCLG9CQUFRcUMsQ0FBUixFQUFXUCxTQUFYLEdBQXVCLGNBQXZCO0FBQ0FzQix1QkFBV2YsQ0FBWDtBQUNEO0FBQ0Y7QUFDRGU7QUFDQSxhQUFLLElBQUlmLEtBQUksQ0FBYixFQUFnQkEsS0FBSXJDLFFBQVFzQyxNQUE1QixFQUFvQ0QsSUFBcEMsRUFBeUM7QUFDdkMsY0FBS0EsTUFBS3JDLE9BQU4sSUFBbUJxQyxPQUFNZSxRQUE3QixFQUF3QztBQUN0Q3BELG9CQUFRcUMsRUFBUixFQUFXUCxTQUFYLEdBQXVCLFVBQXZCO0FBQ0Q7QUFDRjtBQUNEO0FBQ0YsV0FBSyxFQUFMO0FBQVM7QUFDUHNCLG1CQUFXcEQsUUFBUXNDLE1BQW5CO0FBQ0EsYUFBSyxJQUFJRCxNQUFJLENBQWIsRUFBZ0JBLE1BQUlyQyxRQUFRc0MsTUFBNUIsRUFBb0NELEtBQXBDLEVBQXlDO0FBQ3ZDLGNBQUtBLE9BQUtyQyxPQUFOLElBQW1CQSxRQUFRcUMsR0FBUixFQUFXUCxTQUFYLEtBQXlCLFVBQWhELEVBQTZEO0FBQzNEOUIsb0JBQVFxQyxHQUFSLEVBQVdQLFNBQVgsR0FBdUIsY0FBdkI7QUFDQXNCLHVCQUFXZixHQUFYO0FBQ0Q7QUFDRjtBQUNEZTtBQUNBLGFBQUssSUFBSWYsTUFBSSxDQUFiLEVBQWdCQSxNQUFJckMsUUFBUXNDLE1BQTVCLEVBQW9DRCxLQUFwQyxFQUF5QztBQUN2QyxjQUFJQSxPQUFLckMsT0FBTCxJQUFnQnFDLFFBQU1lLFFBQTFCLEVBQW9DO0FBQ2xDcEQsb0JBQVFxQyxHQUFSLEVBQVdQLFNBQVgsR0FBdUIsVUFBdkI7QUFDRDtBQUNGO0FBQ0Q7QUFDRixXQUFLLEVBQUw7QUFBUztBQUNQLGFBQUssSUFBSU8sTUFBSSxDQUFiLEVBQWdCQSxNQUFJckMsUUFBUXNDLE1BQTVCLEVBQW9DRCxLQUFwQyxFQUF5QztBQUN2QyxjQUFLQSxPQUFLckMsT0FBTixJQUFtQkEsUUFBUXFDLEdBQVIsRUFBV1AsU0FBWCxJQUF3QixVQUEvQyxFQUE0RDtBQUMxRHpDLGtCQUFNSyxLQUFOLEdBQWNNLFFBQVFxQyxHQUFSLEVBQVdSLFNBQXpCO0FBQ0F2QyxxQkFBU0MsY0FBVCxDQUF3QixjQUF4QixFQUF3Q3NDLFNBQXhDLEdBQW9ELEVBQXBEO0FBQ0Q7QUFDRjtBQUNEO0FBdENGO0FBd0NEOztBQUVELFdBQVM5QixpQkFBVCxHQUE2QjtBQUMzQixRQUFJdUQsUUFBUWhFLFNBQVNDLGNBQVQsQ0FBd0IsY0FBeEIsRUFBd0NnRSxhQUFwRDtBQUNBbEUsVUFBTUssS0FBTixHQUFjTSxRQUFRc0QsS0FBUixFQUFlekIsU0FBN0I7QUFDQXZDLGFBQVNDLGNBQVQsQ0FBd0IsY0FBeEIsRUFBd0NzQyxTQUF4QyxHQUFvRCxFQUFwRDtBQUNEOztBQUVELFdBQVMzQixVQUFULEdBQXNCO0FBQ3BCSixXQUFPMEQsS0FBUCxDQUFhQyxPQUFiLEdBQXVCLE1BQXZCO0FBQ0Q7O0FBRUQsV0FBU3RELFVBQVQsR0FBc0I7QUFDcEJMLFdBQU8wRCxLQUFQLENBQWFDLE9BQWIsR0FBdUIsT0FBdkI7QUFDRDtBQUVGLENBOU5EIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIC8vIElmIHRoZXJlIGlzbid0IG5hbWVzIGFycmF5IHlldFxyXG4gIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncG9rZW1vbnNOYW1lcycpID09PSBudWxsKSB7XHJcbiAgICAvLyBUYWtlIG5hbWVzIGZyb20gcHVibGljIEFQSVxyXG4gICAgZ2V0UG9rZW1vbnNMaXN0KCk7XHJcbiAgfVxyXG5cclxuICAvLyBUYWtlIG5hbWVzIGZyb20gbG9jYWxTdG9yYWdlXHJcbiAgbGV0IG5hbWVzID0gbG9jYWxTdG9yYWdlLnBva2Vtb25zTmFtZXMgPyBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5wb2tlbW9uc05hbWVzKSA6IFtdO1xyXG5cclxuICBsZXQgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXQnKTtcclxuXHJcbiAgLy9DYWxsIHNlbGVjdFN1aXRhYmxlIGZ1bmN0aW9uIGV2ZXJ5IHRpbWUgd2hlbiBpbnB1dCBpcyBjaGFuZ2VkXHJcbiAgaW5wdXQub25pbnB1dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHNlbGVjdFN1aXRhYmxlKGlucHV0LnZhbHVlLnRvTG93ZXJDYXNlKCkpXHJcbiAgfTtcclxuXHJcbiAgLy8gQ2hvb3NlIG5hbWUgd2l0aCBrZXlib2FyZFxyXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgaGFuZGxlS2V5KTtcclxuXHJcbiAgbGV0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvY29tcGxldGUnKTtcclxuXHJcbiAgLy8gQ2hvb3NlIG5hbWUgd2l0aCBtb3VzZVxyXG4gIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dDbGlja2VkT3B0aW9uKTtcclxuXHJcbiAgbGV0IG9wdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0b2NvbXBsZXRlJykuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ29wdGlvbicpO1xyXG5cclxuICAvLyBIaWRlIHByZWRpY3Rpb25zIHdoZW4gdGhlcmUncyBvbmJsdXIgZXZlbnRcclxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgaGlkZVNlbGVjdCk7XHJcblxyXG4gIC8vIFNob3cgcHJlZGljdGlvbnMgd2hlbiB1c2VyICdyZXR1cm5zJyB0byBpbnB1dDsgdGhlcmUncyBvbmZvY3VzIGV2ZW50XHJcbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCBzaG93U2VsZWN0KTtcclxuXHJcbiAgLy8gKioqKioqKioqKioqKiogIFxyXG4gIC8vIEFsbCBmdW5jdGlvbnMgYXJlIGJlbG93XHJcbiAgLy8gKioqKioqKioqKioqKipcclxuICBmdW5jdGlvbiBnZXRQb2tlbW9uc0xpc3QoKSB7XHJcbiAgICAvLyBBcyB0aGVyZSBhcmUgODExIHBva2Vtb25zIGluIHd3dy5wb2tlYXBpLmNvLCBsaW1pdD04MTFcclxuICAgIGxldCB1cmwgPSAnaHR0cDovL3d3dy5wb2tlYXBpLmNvL2FwaS92Mi9wb2tlbW9uLz9saW1pdD04MTEnO1xyXG5cclxuICAgIC8vIENyZWF0ZSBuZXcgb2JqZWN0IFhNTEh0dHBSZXF1ZXN0XHJcbiAgICBsZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICAvLyBDb25maWdlIG9iamVjdCBYTUxIdHRwUmVxdWVzdFxyXG4gICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XHJcbiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gcmVjZWl2ZVJlc3BvbnNlO1xyXG4gICAgeGhyLnNlbmQoKTtcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gcmVjZWl2ZVJlc3BvbnNlKGUpIHtcclxuICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PSA0KSB7XHJcbiAgICAgICAgLy8geGhyLnJlYWR5U3RhdGUgPT0gNCwgc28gd2UndmUgcmVjZWl2ZWQgdGhlIGNvbXBsZXRlIHNlcnZlciByZXNwb25zZVxyXG4gICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PSAyMDApIHsgLy8geGhyLnN0YXR1cyA9PSAyMDAsIHNvIHRoZSByZXNwb25zZSBpcyBnb29kXHJcbiAgICAgICAgICBsZXQgcmVzdWx0ID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcclxuICAgICAgICAgIGhhbmRsZU5hbWVzKHJlc3VsdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG5vTmFtZXMoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhhbmRsZU5hbWVzKHJlc3VsdCkge1xyXG5cclxuICAgIC8vIEdldCBwb2tlbW9ucyBhcnJheVxyXG4gICAgbGV0IHBva2Vtb25zQXJyID0gcmVzdWx0LnJlc3VsdHM7XHJcblxyXG4gICAgLy8gR2V0IHBva2Vtb25zJyBuYW1lc1xyXG4gICAgbGV0IHBva2Vtb25zTmFtZXMgPSBwb2tlbW9uc0Fyci5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgcmV0dXJuIGl0ZW0ubmFtZTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIERlbGV0ZSBub3QgdW5pcXVlIG5hbWVzIGlmIHRoZXJlIGFyZVxyXG4gICAgcG9rZW1vbnNOYW1lcyA9IHVuaXF1ZShwb2tlbW9uc05hbWVzKTtcclxuXHJcbiAgICAvLyBTb3J0IG5hbWVzIGJ5IGFscGhhYmV0XHJcbiAgICBwb2tlbW9uc05hbWVzID0gcG9rZW1vbnNOYW1lcy5zb3J0KCk7XHJcblxyXG4gICAgLy8gSW4gY2FzZSBpZiBBUEkgcmV0dXJucyByZXN1bHRzIHdpdGggY2FwaXRhbCBsZXR0ZXJzXHJcbiAgICBwb2tlbW9uc05hbWVzID0gcG9rZW1vbnNOYW1lcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgcmV0dXJuIGl0ZW0udG9Mb2NhbGVMb3dlckNhc2UoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFdyaXRlIG5hbWVzIGFycmF5IGludG8gbG9jYWxTdG9yYWdlXHJcbiAgICBsb2NhbFN0b3JhZ2UucG9rZW1vbnNOYW1lcyA9IEpTT04uc3RyaW5naWZ5KHBva2Vtb25zTmFtZXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gSXQgdGhlcmUncyBzb21lIHRyb3VibGUgd2l0aCB0aGUgcmVzcG9uc2UgZnJvbSBBUElcclxuICBmdW5jdGlvbiBub05hbWVzKCkge1xyXG4gICAgbGV0IHNvcnJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgc29ycnkuaW5uZXJIVE1MID0gJ1NvcnJ5LCBzZXJ2aWNlIGlzIHVuYXZhaWxhYmxlLiBObyBwb2tlbW9uc1xcJyBuYW1lcyBmb3IgdGhlIHByZWRpY3Rpb24gaXMgYXQgdGhlIG1vbWVudC4nO1xyXG4gICAgc29ycnkuY2xhc3NOYW1lID0gJ3NvcnJ5JztcclxuXHJcbiAgICBsZXQgc2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbnRhaW5lcicpWzBdO1xyXG4gICAgbGV0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdmb3JtJylbMF07XHJcbiAgICBzZWN0aW9uLmluc2VydEJlZm9yZShzb3JyeSwgZm9ybSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB1bmlxdWUoYXJyKSB7XHJcbiAgICAvLyBDcmVhdGUgc3Vic2lkaWFyeSBvYmplY3RcclxuICAgIGxldCBvYmogPSB7fTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICBsZXQgc3RyID0gYXJyW2ldOyAvLyBNYWtlIHN0cmluZyBmcm9tIGVhY2ggYXJyYXkgZWxlbWVudFxyXG4gICAgICBvYmpbc3RyXSA9IHRydWU7IC8vIFJlbWVtYmVyIGVhY2ggc3RyaW5nIGxpa2Ugb2JqZWN0IHByb3BlcnR5XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZWxlY3RTdWl0YWJsZSh0ZXh0KSB7XHJcbiAgICBpZiAodGV4dC5sZW5ndGggPT09IDApIHtcclxuICAgICAgY2xlYXJQcmVkaWN0aW9ucygpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgYW1vdW50ID0gMDtcclxuICAgIGxldCBzdWl0TmFtZXMgPSBbXTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIC8vIENvbXBhcmUgZXZlcnkgYXJyYXkgZWxlbWVudCB3aXRoIGlucHV0IHRleHRcclxuICAgICAgbGV0IHJpZ3RoTGVuZ3RoID0gMDtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0ZXh0Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgaWYgKG5hbWVzW2ldW2pdID09PSB0ZXh0W2pdKSB7XHJcbiAgICAgICAgICByaWd0aExlbmd0aCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gSWYgbGVuZ3RoIG9mIHJpZ2h0IHN5bWJvbCBpcyBlcXVhbCB0ZXh0IChpbnB1dC52YWx1ZSkgbGVuZ3RoXHJcbiAgICAgIGlmIChyaWd0aExlbmd0aCA9PT0gdGV4dC5sZW5ndGgpIHtcclxuICAgICAgICBzdWl0TmFtZXNbYW1vdW50XSA9IG5hbWVzW2ldO1xyXG4gICAgICAgIGFtb3VudCsrO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBJZiB0aGVyZSdzIGFscmVhZHkgNSBwcmVkaWN0aW9ucywgc3RvcFxyXG4gICAgICBpZiAoYW1vdW50ID09PSA1KSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzaG93UHJlZGljdGlvbnMoc3VpdE5hbWVzKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNsZWFyUHJlZGljdGlvbnMoKSB7XHJcbiAgICBsZXQgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG9jb21wbGV0ZScpO1xyXG4gICAgc2VsZWN0LmlubmVySFRNTCA9ICcnO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvd1ByZWRpY3Rpb25zKGFycikge1xyXG4gICAgY2xlYXJQcmVkaWN0aW9ucygpO1xyXG5cclxuICAgIGxldCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0b2NvbXBsZXRlJyk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgbGV0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgICBvcHRpb24uaW5uZXJIVE1MID0gYXJyW2ldO1xyXG4gICAgICBvcHRpb24udmFsdWUgPSBhcnJbaV07XHJcbiAgICAgIG9wdGlvbi5jbGFzc05hbWUgPSAnb3B0aW9uJztcclxuICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgZnVuY3Rpb24gaGFuZGxlS2V5KGV2ZW50KSB7XHJcbiAgICBsZXQgb3B0aW9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvY29tcGxldGUnKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3B0aW9uJyk7XHJcbiAgICBsZXQgc2VsZWN0ZWQgPSAtMTtcclxuICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xyXG4gICAgY2FzZSA0MDogLy8gS2V5IERvd24gYXJyb3cgaXMgcHJlc3NlZFxyXG4gICAgICBzZWxlY3RlZCA9IC0xO1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAoKGkgaW4gb3B0aW9ucykgJiYgKG9wdGlvbnNbaV0uY2xhc3NOYW1lID09PSAnc2VsZWN0ZWQnKSkge1xyXG4gICAgICAgICAgb3B0aW9uc1tpXS5jbGFzc05hbWUgPSAnbm9uLXNlbGVjdGVkJztcclxuICAgICAgICAgIHNlbGVjdGVkID0gaTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgc2VsZWN0ZWQrKztcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKChpIGluIG9wdGlvbnMpICYmIChpID09PSBzZWxlY3RlZCkpIHtcclxuICAgICAgICAgIG9wdGlvbnNbaV0uY2xhc3NOYW1lID0gJ3NlbGVjdGVkJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlIDM4OiAvLyBLZXkgVXAgYXJyb3cgaXMgcHJlc3NlZFxyXG4gICAgICBzZWxlY3RlZCA9IG9wdGlvbnMubGVuZ3RoO1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAoKGkgaW4gb3B0aW9ucykgJiYgKG9wdGlvbnNbaV0uY2xhc3NOYW1lID09PSAnc2VsZWN0ZWQnKSkge1xyXG4gICAgICAgICAgb3B0aW9uc1tpXS5jbGFzc05hbWUgPSAnbm9uLXNlbGVjdGVkJztcclxuICAgICAgICAgIHNlbGVjdGVkID0gaTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgc2VsZWN0ZWQtLTtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGkgaW4gb3B0aW9ucyAmJiBpID09PSBzZWxlY3RlZCkge1xyXG4gICAgICAgICAgb3B0aW9uc1tpXS5jbGFzc05hbWUgPSAnc2VsZWN0ZWQnO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgMTM6IC8vIEtleSBFbnRlciBpcyBwcmVzc2VkXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmICgoaSBpbiBvcHRpb25zKSAmJiAob3B0aW9uc1tpXS5jbGFzc05hbWUgPT0gJ3NlbGVjdGVkJykpIHtcclxuICAgICAgICAgIGlucHV0LnZhbHVlID0gb3B0aW9uc1tpXS5pbm5lckhUTUw7XHJcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0b2NvbXBsZXRlJykuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvd0NsaWNrZWRPcHRpb24oKSB7XHJcbiAgICBsZXQgaW5kZXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0b2NvbXBsZXRlJykuc2VsZWN0ZWRJbmRleDtcclxuICAgIGlucHV0LnZhbHVlID0gb3B0aW9uc1tpbmRleF0uaW5uZXJIVE1MO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG9jb21wbGV0ZScpLmlubmVySFRNTCA9ICcnO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaGlkZVNlbGVjdCgpIHtcclxuICAgIHNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvd1NlbGVjdCgpIHtcclxuICAgIHNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICB9XHJcblxyXG59KSgpOyJdfQ==
